<!DOCTYPE html>
<html>
<head>
  <title>Drug Info & NDC Comparison</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fdf9ff;
      padding: 20px;
      max-width: 1000px;
      margin: auto;
      color: #2e003e;
    }
    h2, h3 {
      color: #5a189a;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background-color: #7209b7;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #560bad;
    }
    .result-section {
      background: #f3e8ff;
      padding: 15px;
      margin-top: 10px;
      border-left: 4px solid #9d4edd;
    }
    .note {
      font-size: 0.9em;
      color: #444;
      margin-bottom: 15px;
    }
    a {
      color: #5a189a;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .disclaimer {
      margin-top: 40px;
      font-size: 0.85em;
      color: #666;
      border-top: 1px solid #ccc;
      padding-top: 15px;
    }
  </style>
</head>
<body>
  <h2>Drug Info & NDC Comparison</h2>

  <div class="note">
    Enter an <strong>NDC</strong> or <strong>Drug Name</strong> into Box 1 to look up drug information.<br>
    Optionally, enter a second NDC into Box 2 to compare for equivalence.<br>
    <strong>Box 2 is optional.</strong>
  </div>

  <label for="ndc1">Box 1 (NDC or Drug Name):</label>
  <input type="text" id="ndc1" onkeypress="if(event.key === 'Enter') compareNDCs()" />

  <label for="ndc2">Box 2 (NDC optional):</label>
  <input type="text" id="ndc2" onkeypress="if(event.key === 'Enter') compareNDCs()" />

  <button onclick="compareNDCs()">Compare or Lookup</button>
  <button onclick="resetForm()">Reset</button>

  <h3>Result:</h3>
  <div id="result" class="result-section">Results will appear here...</div>

  <div class="disclaimer">
    <strong>Disclaimer:</strong> This tool is in <em>beta</em> and intended for informational purposes only.
    Data is sourced from public APIs and may not reflect the most current or complete information.
  </div>

<script>
  function formatNdc(ndc) {
    ndc = ndc.replace(/[^0-9]/g, '').padStart(11, '0');
    return ndc.slice(0, 5) + '-' + ndc.slice(5, 9) + '-' + ndc.slice(9);
  }

  async function getNdcProperties(ndc) {
    const res = await fetch("https://rxnav.nlm.nih.gov/REST/ndcproperties.json?id=" + formatNdc(ndc));
    const json = await res.json();
    return json?.ndcPropertyList?.ndcProperty?.[0] || {};
  }

  function rxcuiLink(rxcui) {
    return `https://rxnav.nlm.nih.gov/REST/rxcui/${rxcui}`;
  }

  function lexicompLink(ndc) {
    return `https://online.lexi.com/lco/action/search?q=${ndc}&t=name`;
  }

  function detailsLink(ndc) {
    return `details.html?ndc=${ndc}`;
  }

  function resetForm() {
    document.getElementById("ndc1").value = "";
    document.getElementById("ndc2").value = "";
    document.getElementById("result").innerHTML = "Results will appear here...";
  }

  async function compareNDCs() {
    const input1 = document.getElementById("ndc1").value.trim();
    const input2 = document.getElementById("ndc2").value.trim();
    const output = document.getElementById("result");
    output.innerHTML = "Loading...";

    if (!input1 && !input2) {
      output.innerHTML = "Please enter a value in Box 1.";
      return;
    }

    try {
      const prop1 = await getNdcProperties(input1);
      let displayHTML = "";

      if (!input2) {
        displayHTML += `<b>${prop1.proprietaryName || 'Unknown'}</b><br>`;
        displayHTML += `NDC: ${input1}<br>`;
        displayHTML += `RxCUI: ${prop1.rxcui || 'Unknown'} `;
        if (prop1.rxcui) displayHTML += `‚Äî <a href='${rxcuiLink(prop1.rxcui)}' target='_blank'>RxNav</a><br>`;
        else displayHTML += `<br>`;
        displayHTML += `Labeler: ${prop1.labelerName || 'Unknown'}<br>`;
        displayHTML += `Package: ${prop1.packageDescription || 'Unknown'}<br>`;
        displayHTML += `Lexicomp: <a href='${lexicompLink(input1)}' target='_blank'>Link</a><br>`;
        displayHTML += `Details: <a href='${detailsLink(input1)}' target='_blank'>More Info</a><br>`;
        output.innerHTML = displayHTML;
        return;
      }

      const prop2 = await getNdcProperties(input2);
      const rxcui1 = prop1.rxcui;
      const rxcui2 = prop2.rxcui;

      const match = rxcui1 && rxcui2 && rxcui1 === rxcui2;
      const status = match
        ? "‚úîÔ∏è <b>Equivalent RxCUI</b>"
        : "‚ö†Ô∏è <b>Different RxCUI</b> ‚Äî may still be clinically equivalent";

      displayHTML += `${status}<br><br>`;
      displayHTML += `<table>
        <tr><th></th><th>NDC</th><th>RxCUI</th><th>Labeler</th><th>Package</th><th>Lexicomp</th><th>Details</th></tr>
        <tr>
          <td><b>Box 1</b></td>
          <td>${input1}</td>
          <td>${rxcui1 ? `<a href='${rxcuiLink(rxcui1)}' target='_blank'>${rxcui1}</a>` : 'Unknown'}</td>
          <td>${prop1.labelerName || 'Unknown'}</td>
          <td>${prop1.packageDescription || 'Unknown'}</td>
          <td><a href='${lexicompLink(input1)}' target='_blank'>Link</a></td>
          <td><a href='${detailsLink(input1)}' target='_blank'>More Info</a></td>
        </tr>
        <tr>
          <td><b>Box 2</b></td>
          <td>${input2}</td>
          <td>${rxcui2 ? `<a href='${rxcuiLink(rxcui2)}' target='_blank'>${rxcui2}</a>` : 'Unknown'}</td>
          <td>${prop2.labelerName || 'Unknown'}</td>
          <td>${prop2.packageDescription || 'Unknown'}</td>
          <td><a href='${lexicompLink(input2)}' target='_blank'>Link</a></td>
          <td><a href='${detailsLink(input2)}' target='_blank'>More Info</a></td>
        </tr>
      </table>`;

      displayHTML += `<br>üîç <i>Note: Use clinical judgment. RxCUI mismatch doesn't guarantee clinical difference.</i>`;
      output.innerHTML = displayHTML;
    } catch (err) {
      output.innerHTML = "‚ö†Ô∏è Error: " + err.message;
    }
  }
</script>
</body>
</html>
