<!DOCTYPE html>
<html>
<head>
  <title>Drug Info & NDC Comparison</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fdf9ff;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      color: #2e003e;
    }
    h2, h3 {
      color: #5a189a;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background-color: #7209b7;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #560bad;
    }
    pre, #result {
      background: #f3e8ff;
      padding: 15px;
      white-space: pre-wrap;
      border-left: 4px solid #9d4edd;
      margin-top: 10px;
    }
    .disclaimer {
      margin-top: 40px;
      font-size: 0.85em;
      color: #666;
      border-top: 1px solid #ccc;
      padding-top: 15px;
    }
    .note {
      font-size: 0.9em;
      color: #444;
      margin-bottom: 15px;
    }
    a {
      color: #5a189a;
    }
  </style>
</head>
<body>
  <h2>Drug Info & NDC Comparison</h2>

  <div class="note">
    Enter an <strong>NDC</strong> or <strong>Drug Name</strong> into Box 1 to look up drug information.<br>
    Optionally, enter a second NDC into Box 2 to compare for equivalence.<br>
    <strong>Box 2 is optional.</strong>
  </div>

  <label for="ndc1">Box 1 (NDC or Drug Name):</label>
  <input type="text" id="ndc1" />

  <label for="ndc2">Box 2 (NDC optional):</label>
  <input type="text" id="ndc2" />

  <button onclick="compareNDCs()">Compare or Lookup</button>

  <h3>Result:</h3>
  <pre id="result">Results will appear here...</pre>

  <div class="disclaimer">
    <strong>Disclaimer:</strong> This tool is in <em>beta</em> and intended for informational purposes only.
    Data is sourced from public APIs and may not reflect the most current or complete information.
  </div>

<script>
  function formatNdc(ndc) {
    ndc = ndc.replace(/[^0-9]/g, '').padStart(11, '0');
    return ndc.slice(0, 5) + '-' + ndc.slice(5, 9) + '-' + ndc.slice(9);
  }

  async function getRxcuiFromNdc(ndc) {
    const res = await fetch("https://rxnav.nlm.nih.gov/REST/ndcproperties.json?id=" + formatNdc(ndc));
    const json = await res.json();
    return json?.ndcPropertyList?.ndcProperty?.[0]?.rxcui || null;
  }

  async function getRxcuiFromDrugName(name) {
    const res = await fetch("https://rxnav.nlm.nih.gov/REST/rxcui.json?name=" + encodeURIComponent(name));
    const json = await res.json();
    return json?.idGroup?.rxnormId?.[0] || null;
  }

  async function getBrandName(rxcui) {
    const res = await fetch("https://rxnav.nlm.nih.gov/REST/rxcui/" + rxcui + "/related.json?tty=BN");
    const json = await res.json();
    return json?.relatedGroup?.conceptGroup?.[0]?.conceptProperties?.[0]?.name || "Unknown";
  }

  async function getFullName(rxcui) {
    const res = await fetch("https://rxnav.nlm.nih.gov/REST/rxcui/" + rxcui + "/properties.json");
    const json = await res.json();
    return json?.properties?.name || "Unknown";
  }

  async function getNdcListFromRxcui(rxcui) {
    const res = await fetch("https://rxnav.nlm.nih.gov/REST/rxcui/" + rxcui + "/ndcs.json");
    const json = await res.json();
    return json?.ndcGroup?.ndcList?.ndc || [];
  }

  async function compareNDCs() {
    const input1 = document.getElementById("ndc1").value.trim();
    const input2 = document.getElementById("ndc2").value.trim();
    const output = document.getElementById("result");
    output.innerHTML = "Loading...";

    if (!input1 && !input2) {
      output.innerHTML = "Please enter a value in Box 1.";
      return;
    }

    try {
      if (input1 && !input2) {
        let rxcui = await getRxcuiFromNdc(input1);
        if (!rxcui) rxcui = await getRxcuiFromDrugName(input1);

        if (!rxcui) {
          output.innerHTML = "No RxCUI found for input.";
          return;
        }

        const [name, brand] = await Promise.all([
          getFullName(rxcui),
          getBrandName(rxcui)
        ]);
        const ndcs = await getNdcListFromRxcui(rxcui);

        const ndcListHTML = ndcs.length
          ? ndcs.map(n => `‚Ä¢ ${n}`).join("\n")
          : "No NDCs found.";

        output.innerHTML =
          `<b>üßæ Drug Information</b><br><br>` +
          `Name: ${name}<br>` +
          `Brand: ${brand}<br>` +
          `RxCUI: <a href='https://rxnav.nlm.nih.gov/REST/rxcui/${rxcui}' target='_blank'>${rxcui}</a><br><br>` +
          `<b>NDCs:</b><br><pre>${ndcListHTML}</pre>`;
        return;
      }

      const [rxcui1, rxcui2] = await Promise.all([
        getRxcuiFromNdc(input1),
        getRxcuiFromNdc(input2)
      ]);

      if (!rxcui1 || !rxcui2) {
        output.innerHTML = "One or both NDCs not found.";
        return;
      }

      const [name1, brand1, name2, brand2] = await Promise.all([
        getFullName(rxcui1), getBrandName(rxcui1),
        getFullName(rxcui2), getBrandName(rxcui2)
      ]);

      const match = rxcui1 === rxcui2;
      const status = match
        ? "‚úîÔ∏è <b>Equivalent RxCUI</b>"
        : "‚ö†Ô∏è <b>Different RxCUI</b> ‚Äî may still be clinically equivalent";

      output.innerHTML =
        `${status}<br><br>` +
        `<b>NDC 1:</b><br>` +
        `Name: ${name1}<br>` +
        `Brand: ${brand1}<br>` +
        `RxCUI: <a href='https://rxnav.nlm.nih.gov/REST/rxcui/${rxcui1}' target='_blank'>${rxcui1}</a><br><br>` +
        `<b>NDC 2:</b><br>` +
        `Name: ${name2}<br>` +
        `Brand: ${brand2}<br>` +
        `RxCUI: <a href='https://rxnav.nlm.nih.gov/REST/rxcui/${rxcui2}' target='_blank'>${rxcui2}</a><br><br>` +
        `üîç <i>Note: Two drugs may be clinically equivalent even if RxCUIs differ (e.g., different release forms or packages). Use clinical judgment and references.</i>`;

    } catch (err) {
      output.innerHTML = "‚ö†Ô∏è Error: " + err.message;
    }
  }
</script>
</body>
</html>